<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  Copyright (c) 2016-2018 Qualcomm Technologies, Inc.
  All Rights Reserved.
  Confidential and Proprietary - Qualcomm Technologies, Inc.
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-->
<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"></meta>
<meta http-equiv="X-UA-Compatible" content="IE=9"></meta>
<title>Snapdragon Neural Processing Engine SDK: Input Image Formatting</title>
<link href="tabs.css" rel="stylesheet" type="text/css"></link>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="autoEnterCurrentDate.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="is.css" rel="stylesheet" type="text/css" ></link>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Snapdragon Neural Processing Engine SDK
   <span id="projectnumber"></span></div>
   <div id="projectbrief">Reference Guide</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('image_input.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Input Image Formatting </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="input_image_layout"></a>
Input Images</h1>
<p>In addition to converting the model, SNPE also requires the input image to be in a specific format that might be different from the source framework.</p>
<p>In Caffe, the image is presented as a tensor of shape <code>(batch x channel x height x width)</code>, where width is the fastest-changing dimension, followed by height, then color channel. This means that all the pixel values of the first color channel are contiguous in memory, followed by all the pixel values of the next color channel, and so forth. Caffe prepares the images in this format in the <code>convert_imageset</code> tool during the training process.</p>
<p>In SNPE, the image must be presented as a tensor of shape <code>(batch x height x width x channel)</code>, where channel is the fastest-changing dimension. This means that values for all the color channels of a single pixel are contiguous in memory, followed by all the color values of the next pixel, and so forth.</p>
<p>If the batch dimension is greater than 1, the individual images have to be manually concatenated together into a single file for each batch.</p>
<p>See the figure below for a visual representations of the two input image memory layouts.</p>
<p><b>Note:</b></p>
<p>The channel order used during inference must be the same as that used during training. For example, Imagenet models trained in Caffe require a channel order of BGR.</p>
<h2><a class="anchor" id="input_image_for_imagenet_models"></a>
Input Image for Imagenet Models</h2>
<p>The Imagenet models in Caffe (such as bvlc_alexnet, bvlc_googlenet, etc.) are trained with BGR images (blue pixels before green pixels before red pixels). The inference engine must be provided the pixel values in the same channel order.</p>
<p>The following image shows the two different input image memory layouts required by Caffe and SNPE for the bvlc_alexnet model. The input image size is 227x227. <br />
</p>
<p><a class="anchor" id="fig_image_layouts"></a><p> <div style= text-align:left;><img src="images/image_layouts.png" alt="SNPE" width="50%" height="50%"><br/><br/><b></b></div><br/> </p>
<h2><a class="anchor" id="input_image_for_mnist_models"></a>
Input Image for MNIST Models</h2>
<p>The MNIST models in Caffe (such as lenet) require single-channel grayscale images of size 28x28. Note that while there is only one channel, an input tensor of 4 dimensions is still required in Caffe <code>(1x1x28x28)</code> and SNPE <code>(1x28x28x1)</code>.</p>
<h2><a class="anchor" id="mean_subtraction"></a>
Mean Subtraction</h2>
<p>Some Caffe models (such as bvlc_alexnet) are trained with images where a mean image has been subtracted from each input image. This mean image is the average of all images in the training set. Caffe generates this mean image in the <code>convert_imageset</code> tool during the training process.</p>
<p>For SNPE, if you are using a network that was trained with images that underwent mean subtraction, then the mean image must be manually subtracted before the image data is written to the input layer. If your network was not trained using mean subtraction, then this step is not necessary.</p>
<p>Mean subtraction can also be performed automatically by SNPE as part of <a class="el" href="input_preprocessing.html#input_preprocessing_meansub">image preprocessing</a>.</p>
<p>SNPE SDK includes a script which accomplishes jpg to raw conversion, including mean subtraction for AlexNet, in <b>$SNPE_ROOT/models/alexnet/scripts/create_alexnet_raws.py</b>. The script in the <a class="el" href="setup.html">SNPE Setup</a> chapter performs this conversion on the sample images provided in the SDK.</p>
<h1><a class="anchor" id="output"></a>
Output</h1>
<p>The output of the example remains the same between Caffe and SNPE: a 1-dimensional tensor containing the probability of each class, for each image in the batch.</p>
<p>For Imagenet models (such as bvlc_alexnet), this is a tensor of size 1000 for the 1000 Imagenet classes.</p>
<p>If the batch dimension of the model is greater than 1, the individual output tensors will be concatenated together along the batch dimension. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  Copyright (c) 2016-2018 Qualcomm Technologies, Inc.
  All Rights Reserved.
  Confidential and Proprietary - Qualcomm Technologies, Inc.
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 -->
<!-- start footer part -->
<div id="nav-path" class="navpath" font-size:small;><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <p align="right">
        80-NL315-14 A <br>
        MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
        <!--If the Controlled Distribution statement is to be included, uncomment below:-->
        <!--<b>Controlled Distribution - DO NOT COPY</b>-->
        <img class="footer" width:5%; alt="QTI Logo" src="images/QTI_Logo.png" />
      </p>
    </li>
  </ul>
</div>
</body>
</html>
